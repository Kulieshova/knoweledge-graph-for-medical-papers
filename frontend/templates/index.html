<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Graph Visualization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.21.2/cytoscape.min.js"></script>
    <style>
        :root {
            --primary-bg: #e0efee;
            --secondary-bg: #ffffff;
            --tertiary-bg: #33588D;
            --border-color: #e2e8f0;
            --primary-text: #33588D;
            --secondary-text: #315d88;
            --accent-color: #aed4d2;
            --success-color: #48bb78;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Raleway',-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: var(--primary-text);
            line-height: 1.6;
            background: linear-gradient(
                rgba(255, 255, 255, 1) 0%,            /* White at the top */
                rgba(219, 251, 251, 0.9) 25%,         /* Very light blue (#DBFBFB) */
                rgba(187, 231, 232, 0.8) 50%,         /* Light blue (#bbe7e8) */
                rgba(171, 227, 227, 0.8) 100%         /* Soft blue (#ABE3E3) at the bottom */
            );
            min-height: 100vh;
            padding: 2rem;
            background-attachment: fixed;
        }

        
        .title, h1, h2 {
            font-family: 'Quicksand', sans-serif;
        }


        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
            height: calc(100vh - 150px);
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.9);
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 32px; 
            color: var(--primary-text);
            margin-bottom: 0.5rem;
        }
        .header h2 {
            font-family: 'Roboto', sans-serif;    /* Same clean font */
            font-size: 18px;                      /* Slightly smaller than the main title */
            color: #5c5c5c;                       /* Lighter grey for the subtitle */
            font-weight: 400;                     /* Regular weight */
            margin-top: 0;                        /* Remove top margin */
            line-height: 1.5;                     /* Better spacing between lines */
        }

        .main-content {
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
        }

        #cy {
            width: 100%;
            height: 700px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .magnitude-legend {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .magnitude-legend h2 {
            color: var(--primary-text);
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }

        .magnitude-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .magnitude-table th,
        .magnitude-table td {
            padding: 0.75rem;
            text-align: left;
            border: 1px solid #e2e8f0;
        }

        .magnitude-table th {
            background-color: var(--primary-bg);
            color: var(--primary-text);
            font-weight: 600;
        }

        .magnitude-table tr:nth-child(even) {
            background-color: #f8fafc;
        }

        .magnitude-table tr:nth-child(odd) {
            background-color: #ffffff;
        }

        .relationship-ledger {
            background: rgba(255, 255, 255, 0.9);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 2rem;
            height: fit-content;
        }

        .upload-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #FBEDCE;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            min-width: 120px;
            color: var(--primary-text);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
        }

        .button-container {
            display: flex;
            gap: 1.5rem; /* Increased gap between buttons */
            margin-left: 2rem; /* Add some space from the file input */
        }

        .file-input-container {
            flex: 1;
            min-width: 200px; /* Ensure minimum width for file input */
        }

        .upload-section {
            display: flex;
            align-items: center;
            padding: 1.5rem 2rem; /* Increased padding */
            justify-content: space-between;
        }

        #fetchButton {
            background-color: #ABE3E3;
            color: var(--primary-text);
        }

        #helpButton {
            background-color: #BCEBBC;
            color: var(--primary-text);
        }
        #cy {
            width: 100%;
            height: 700px;
            background-color: var(--secondary-bg);
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #output {
            padding: 1rem;
            background-color: var(--secondary-bg);
            border-radius: 0.5rem;
            color: var(--secondary-text);
            font-family: monospace;
            display: none;
        }

        .relationship-ledger {
            background-color: var(--secondary-bg);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 2rem;
            height: fit-content;
        }

        .relationship-ledger h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: var(--primary-text);
        }

        .relationship-table {
            width: 100%;
            border-collapse: collapse;
        }

        .relationship-table th,
        .relationship-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .relationship-table th {
            background-color: var(--primary-bg);
            font-weight: 600;
        }

        .color-circle {
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            display: inline-block;
            vertical-align: middle;
            margin-right: 0.5rem;
            border: 2px solid var(--border-color);
        }

        .magnitude-legend {
            margin-top: 20px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .magnitude-legend h2 {
            color: var(--primary-text);
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }

        .magnitude-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .magnitude-table th, 
        .magnitude-table td {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
        }

        .magnitude-table th {
            background-color: var(--primary-bg);
            color: var(--primary-text);
            font-weight: 600;
        }

        .magnitude-table tr:nth-child(even) {
            background-color: rgba(224, 239, 238, 0.3);
        }

        .magnitude-table tr:hover {
            background-color: rgba(174, 212, 210, 0.1);
        }

        #status {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            display: none;
        }

        #status.success {
            background-color: #c6f6d5;
            color: #2f855a;
        }

        #status.error {
            background-color: #fed7d7;
            color: #c53030;
        }

        #loadingtext {
            display: none;
            text-align: center;
            padding: 0.5rem;
            color: var(--primary-text);
            font-weight: 600;
        }

        #popup {
            position: absolute;
            display: none;
            background: white;
            border: 1px solid var(--border-color);
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
    /* Popup Styling */
        #helpPopup {
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0, 0, 0, 0.4); /* Dark overlay */
            justify-content: center; 
            align-items: center;
            z-index: 1000;
        }

        .popup-content {
            background-color: rgba(250, 250, 250, 1); /* Light background */
            width: 90%;
            max-width: 500px;
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
            color: #2D4D85; /* Dark blue text for readability */
            font-family: 'Raleway', sans-serif;
            position: relative;
        }

        .popup-content h2 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: #2D4D85;
        }

        .popup-content p {
            font-size: 1rem;
            color: #555; 
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .popup-content button {
            padding: 0.6rem 1.2rem;
            font-size: 1rem;
            font-weight: 600;
            background-color: rgba(171, 227, 227, 1); /* Matching button color */
            color: white;
            border: none;
            border-radius: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .popup-content button:hover {
            background-color: rgba(136, 217, 217, 1); /* Slightly darker for hover */
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
        }
        .logo-container {
            position: fixed;
            bottom: 10px;
            right: 10px;
            z-index: 1000;
        }

        .logo {
            width: 100px; /* Adjust the size as needed */
            opacity: 0.8; /* Makes the logo slightly transparent */
        }
        /* Hide the default file input */
        input[type="file"] {
        display: none;
        }

        /* Style for the custom label */
        .custom-file-label {
            display: inline-block;
            background-color: #F3A475 ;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 1.5rem; /* Rounded for a cute look */
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

/* Hover effect */
        .custom-file-label:hover {
            background-color: #ee7d3a; /* Slightly darker shade for hover */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

/* Add an icon before the text */
        .custom-file-label::before {
            content: '📁'; /* Folder icon */
            display: inline-block;
            margin-right: 8px;
            font-size: 1.2rem;
        }
/* For the search funt.*/
        .search-container {
            margin: 1rem 0;
            display: flex;
            gap: 0.5rem;
        }
        #searchInput {
            padding: 0.5rem;
            border: none; /* Matching the Brightside theme */
            border-radius: 0.5rem;
            width: 100%;  
        }
        .search-button {
            background-color: #ABE3E3;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            color: #333;
        }
     
        .highlighted {
            background-color: #F3A475 !important; /* Bright, noticeable color */
            border-color: #ed732a;
            border-width: 2px;
            color: #000;
        }
            .color-green { background-color: #A0E1A0; }   /* Highly effective */
            .color-yellow { background-color: #FAD02E; }  /* Clinical Recommendations */
            .color-red { background-color: #FF6B6B; }     /* Side effects */
            .color-orange { background-color: #FFB3BA; }  /* Treatment Options */
            .color-blue { background-color: #77aad4; }    /* General Information */
            .color-pink { background-color: #a891f2; }    /* Comparative Usage Patterns */
            .color-purple { background-color: #FFEB99; }  /* Symptom */
            .green-blue { background-color: #72B7B2; }
    </style>
</head>
<body>
    <div class="header">
      <h1>Mental Health Treatment Pathways: A Knowledge Graph Approach</h1>
      <h2>Developing a Depression & Anxiety Prescription Knowledge-Base with Machine Learning</h2>
    </div>
    
    <div class="container">
        <div class="main-content">
            <section class="upload-section">
                <form id="uploadForm" action="/upload" method="POST" enctype="multipart/form-data" style="display: flex; width: 100%; align-items: center;"> 
                    <div class="file-input-container">
                        <input type="file" name="files[]" multiple id="fileInput" class="file-input">
                        <label for="fileInput" class="custom-file-label">Choose Files</label>
                    </div>
                    <div class="button-container">
                        <button type="submit">Upload Files</button>
                        <button id="fetchButton" type="button">Fetch Last Graph</button>
                        <button id="helpButton" type="button">Help</button>
                    </div>
                </form>
            </section>
                
            <div class="search-container">
               <input type="text" id="searchInput" placeholder="Search nodes...">
               <button class="search-button" onclick="findNode()">Search</button>
            </div>
                
            <div id="cy"></div> <!--where the graph appears -->
            
            <div id="statusContainer">
                <div id="statusMessage" class="status-message"></div>
                <div id="spinner"></div>
            </div>

            <div class="loading-container">
                <div id="spinner"></div>
                <div id="loadingtext">Processing your files...</div>
                <pre id="output"></pre>
            </div>
            <div class="magnitude-legend">
                <h2>Magnitude Legend</h2>
                <table class="magnitude-table">
                    <tr><th>Magnitude Level</th><th>Counts</th><th>Relationships</th></tr>
                    <tr><td>High Magnitude </td><td>18, 9, 7, 7</td><td>'first-line treatment', 'Definition', 'Highly effective', 'Treats'</td></tr>
                    <tr><td>Moderately High Magnitude </td><td>6 (all)</td><td>'More effective', 'Comparable to', 'Side effects', 'Associated with'</td></tr>
                    <tr><td>Moderate Magnitude </td><td>5, 4, 4, 3</td><td>'Side effects', 'Second-line treatment', 'Less effective', 'Symptom'</td></tr>
                    <tr><td>Low Magnitude </td><td>2, 1 (all)</td><td>'Properties', 'Less Commonly Used', 'Specific efficacy in treating', 
                    'Less effective', 'Most effective', 'More effective than', 'Effective', 
                    'Specific efficacy in treating', 'More efficacious', 'Highly effective', 
                    'Treatment options', 'Potential alternative', 'Overview', 'Goal', 
                    'Better acceptability', 'More favorable', 'More tolerable', 
                    'More commonly used', 'Widely used', 'Recommendation', 'Recommended'</td></tr>
                </table>
            </div>
        </div>

<aside class="relationship-ledger">
    <h2>Relationship Types</h2>
    <table class="relationship-table">
        <tr><th>Color</th><th>Relationship</th></tr>
        <tr><td><span class="color-circle color-green"></span></td><td>Highly effective / Comparative Effectiveness</td></tr>
        <tr><td><span class="color-circle color-yellow"></span></td><td>Clinical Recommendations</td></tr>
        <tr><td><span class="color-circle color-red"></span></td><td>Side effects / Limitations</td></tr>
        <tr><td><span class="color-circle color-orange"></span></td><td>Treatment Options</td></tr>
        <tr><td><span class="color-circle color-blue"></span></td><td>General Information</td></tr>
        <tr><td><span class="color-circle color-pink"></span></td><td> Usage Patterns</td></tr>
        <tr><td><span class="color-circle color-purple"></span></tdx<td>Symptom</td></tr>
    </table>
</aside>
<script type="module" src="/static/script.js"></script>
   
            <div id="helpPopup" class="popup">
                <div class="popup-content">
                    <h2>Need Help?</h2>
                    <p><strong>Instructions:</strong> Click "Choose Files" to select one or more PDFs. Then, click "Upload Files" to start. After that, you’ll see the message "Processing your files..." as the files are analyzed.</p>
                    <p><strong>Graph Fetch:</strong> To view your last saved graph, click "Fetch Last Graph."</p>
                    <p><strong>Explanation:</strong> Each circular node represents an idea or term, and lines connect related ideas. Each line is color coded based on its category in the <strong> Relationship Types</strong> shown on the right. <strong>The width of each line reflects the strength of the connection</strong>, as shown in the <strong>Magnitude Legend</strong> on the bottom.</p>
                    <p><strong>Exploring the Graph:</strong> Click and drag circles to rearrange them for better viewing. Use the color-coded sidebar legend to identify relationship types easily.</p>
                    <button id="closePopup">Got it!</button>
                </div>
            </div>
        </div>
    </div>


<script>
    // Show the custom help popup
    document.getElementById('helpButton').addEventListener('click', function () {
        document.getElementById('helpPopup').style.display = 'flex';
    });

    // Close the custom help popup
    document.getElementById('closePopup').addEventListener('click', function () {
        document.getElementById('helpPopup').style.display = 'none';
    });
</script>


</body>
</html>
    <script type="module">
        import { make_kg } from "/static/script.js";

        function logMessage(message) {
            const cyContainer = document.getElementById('cy');
            cyContainer.innerHTML = "";
            cyContainer.innerHTML += `<div>${message}</div>`;
            cyContainer.scrollTop = cyContainer.scrollHeight;
        }

        document.getElementById('fetchButton').addEventListener('click', async function(event) {
            event.preventDefault();
            try {
                logMessage("Fetching Results fetch");
                const fetchResponse = await fetch('/get_results', {
                    method: 'GET',
                });
                const data = await fetchResponse.json();
                
                if (data) {
                    make_kg(data);
                }
            } catch (error) {
                console.error("Error:", error);
            }
        });

        document.getElementById('uploadForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            const loadingText = document.getElementById("loadingtext");
            loadingText.style.display = 'block';
            
            try {
                logMessage("Extracting Relationships");
                const uploadResponse = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });

                if (!uploadResponse.ok) {
                    throw new Error('Failed to upload files');
                }

                const result = await uploadResponse.json();
                document.getElementById('output').innerText = 'Upload successful!';

                logMessage("Fetching Results");
                const fetchResponse = await fetch('/get_results', { method: 'GET' });
                const data = await fetchResponse.json();
                
                if (data) {
                    make_kg(data);
                }
            } catch (error) {
                document.getElementById('output').innerText = "Error occurred";
            } finally {
                loadingText.style.display = 'none';
            }
        });
    </script>
</body>
</html>    